<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiempo de Reacción - Terapia Visual</title>
    <style>
        :root {
            --bg: #0f172a;
            --accent: #38bdf8;
        }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        
        /* Pantalla de Inicio e Instrucciones */
        #setup-screen, #instruction-screen {
            position: fixed; inset: 0; background: var(--bg); z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center;
        }
        .input-clinico { padding: 12px; font-size: 1rem; border-radius: 8px; border: 2px solid var(--accent); background: #1e293b; color: white; margin: 10px; width: 280px; }
        .btn-grande { background: var(--accent); color: #0f172a; padding: 15px 35px; border-radius: 12px; font-size: 1.5rem; font-weight: bold; cursor: pointer; border: none; margin-top: 20px; }

        /* Área de Juego */
        .header { padding: 10px; border-bottom: 1px solid #334155; width: 100%; text-align: center; }
        #game-canvas { position: relative; width: 100vw; height: calc(100vh - 80px); cursor: crosshair; }
        
        .target {
            position: absolute; width: 80px; height: 80px; border-radius: 50%;
            display: none; cursor: pointer; transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>

    <div id="setup-screen">
        <h1 style="color:var(--accent)">Tiempo de Reacción</h1>
        <input type="text" id="nombrePaciente" class="input-clinico" placeholder="Nombre del Paciente">
        <button class="btn-grande" onclick="irAInstrucciones()">Siguiente</button>
    </div>

    <div id="instruction-screen" style="display:none">
        <h2 style="color:var(--accent)">¿Cómo jugar?</h2>
        <p style="max-width: 450px; line-height: 1.6; font-size: 1.1rem;">
            Aparecerán círculos de colores en diferentes partes de la pantalla.<br><br>
            Tu objetivo es <b>tocarlos lo más rápido posible</b> en cuanto los veas.<br><br>
            ¡Mucha atención!
        </p>
        <button class="btn-grande" onclick="comenzarJuego()">¡Empezar!</button>
    </div>

    <div class="header">
        <span>Paciente: <b id="val-pac">---</b></span> | 
        <span>Último tiempo: <b id="val-time">0</b> ms</span> | 
        <span>Promedio: <b id="val-avg">0</b> ms</span>
    </div>

    <div id="game-canvas" onclick="registrarFallo()">
        <div id="target" class="target" onmousedown="acierto(event)"></div>
    </div>

    <script>
        let paciente = "";
        let startTime, times = [];
        const target = document.getElementById('target');

        function irAInstrucciones() {
            paciente = document.getElementById('nombrePaciente').value.trim();
            if(!paciente) return alert("Por favor, ingrese el nombre");
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('instruction-screen').style.display = 'flex';
        }

        function comenzarJuego() {
            document.getElementById('instruction-screen').style.display = 'none';
            document.getElementById('val-pac').innerText = paciente;
            aparecer();
        }

        function aparecer() {
            const x = Math.random() * (window.innerWidth - 100) + 50;
            const y = Math.random() * (window.innerHeight - 180) + 50;
            const color = `hsl(${Math.random() * 360}, 70%, 60%)`;
            
            target.style.left = x + "px";
            target.style.top = y + "px";
            target.style.backgroundColor = color;
            
            setTimeout(() => {
                target.style.display = "block";
                startTime = Date.now();
            }, Math.random() * 2000 + 500);
        }

        function acierto(e) {
            e.stopPropagation();
            const reactionTime = Date.now() - startTime;
            times.push(reactionTime);
            target.style.display = "none";
            
            document.getElementById('val-time').innerText = reactionTime;
            const avg = Math.round(times.reduce((a, b) => a + b) / times.length);
            document.getElementById('val-avg').innerText = avg;
            
            aparecer();
        }

        function registrarFallo() {
            // Opcional: penalizar o vibrar si toca fuera
        }
    </script>
</body>
</html>
